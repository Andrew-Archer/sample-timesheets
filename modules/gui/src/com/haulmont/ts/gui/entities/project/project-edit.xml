<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/5.4/window.xsd"
        caption="msg://editCaption"
        class="com.haulmont.ts.gui.entities.project.ProjectEdit"
        datasource="projectDs"
        focusComponent="fieldGroup"
        messagesPack="com.haulmont.ts.gui.entities.project">
    <dsContext>
        <datasource id="projectDs"
                    class="com.haulmont.ts.entity.Project"
                    view="fullProjectView">
            <collectionDatasource id="participantsDs"
                                  property="participants"/>
            <collectionDatasource id="tasksDs"
                                  property="tasks"/>
        </datasource>
        <collectionDatasource id="participantsRolesDs"
                              class="com.haulmont.ts.entity.ProjectRole">
            <query>
                <![CDATA[select e from ts$ProjectRole e]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="projectsDs"
                              class="com.haulmont.ts.entity.Project">
            <query>
                <![CDATA[select e from ts$Project e]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="clientsDs"
                              class="com.haulmont.ts.entity.Client">
            <query>
                <![CDATA[select e from ts$Client e]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <layout expand="scrollBox"
            spacing="true">
        <scrollBox id="scrollBox">
            <fieldGroup id="fieldGroup"
                        datasource="projectDs">
                <column width="250px">
                    <field id="name"/>
                    <field id="code"/>
                    <field id="parent"
                           optionsDatasource="projectsDs"/>
                    <field id="client"
                           optionsDatasource="clientsDs"/>
                    <field id="description"
                           custom="true"/>
                    <field id="status"/>
                </column>
            </fieldGroup>
            <groupBox id="participantsBox"
                      caption="msg://com.haulmont.ts.entity/Project.participants">
                <table id="participantsTable"
                       editable="true"
                       height="200px"
                       width="100%">
                    <actions>
                        <action id="create"/>
                        <action id="remove"/>
                    </actions>
                    <columns>
                        <column id="user"/>
                        <column id="role"
                                editable="true"
                                optionsDatasource="participantsRolesDs"/>
                    </columns>
                    <rows datasource="participantsDs"/>
                    <buttonsPanel>
                        <button action="participantsTable.create"/>
                        <button action="participantsTable.remove"/>
                    </buttonsPanel>
                </table>
            </groupBox>
            <groupBox id="tasksBox"
                      caption="msg://com.haulmont.ts.entity/Project.tasks">
                <table id="tasksTable"
                       height="200px"
                       width="100%">
                    <actions>
                        <action id="create"/>
                        <action id="edit"/>
                        <action id="remove"/>
                    </actions>
                    <columns>
                        <column id="name"/>
                        <column id="code"/>
                        <column id="description"/>
                        <column id="project"/>
                        <column id="type"/>
                        <column id="status"/>
                        <column id="requaredTagTypes"/>
                        <column id="defaultTags"/>
                        <column id="participants"/>
                    </columns>
                    <rows datasource="tasksDs"/>
                    <buttonsPanel>
                        <button action="tasksTable.create"/>
                        <button action="tasksTable.edit"/>
                        <button action="tasksTable.remove"/>
                    </buttonsPanel>
                </table>
            </groupBox>
        </scrollBox>
        <iframe id="windowActions"
                screen="editWindowActions"
                stylename="window-actions"/>
    </layout>
</window>
