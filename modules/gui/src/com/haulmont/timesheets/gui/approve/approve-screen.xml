<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/5.5/window.xsd"
        caption="msg://approveScreen"
        class="com.haulmont.timesheets.gui.approve.ApproveScreen"
        focusComponent="usersTable"
        messagesPack="com.haulmont.timesheets.gui.approve">
    <companions>
        <web class="com.haulmont.timesheets.web.approve.WebApproveScreenCompanion"/>
    </companions>
    <dsContext>
        <collectionDatasource id="usersDs"
                              class="com.haulmont.timesheets.entity.ExtUser"
                              view="_local">
            <query>
                <![CDATA[
                select u
                from sec$User u,
                     ts$ProjectParticipant pp
                     join pp.project pr
                     join pr.participants me
                where
                    pp.user.id = u.id and
                    me.user.id = :session$userId and
                    (me.role.code = 'manager' or me.role.code = 'approver')
                    ]]>
            </query>
        </collectionDatasource>
        <collectionDatasource id="weeklyEntriesDs"
                              allowCommit="false"
                              class="com.haulmont.timesheets.entity.WeeklyReportEntry"
                              refreshMode="NEVER"/>
    </dsContext>
    <layout spacing="true" expand="split">
        <buttonsPanel width="100%">
            <hbox/>
            <label id="weekCaption" stylename="h2" align="MIDDLE_CENTER"/>
            <hbox id="weekNavigationBox"
                  spacing="true"
                  align="BOTTOM_RIGHT">
                <dateField id="dateField"
                           resolution="DAY"
                           stylename="simple"
                           align="MIDDLE_RIGHT"/>
                <linkButton icon="font-icon:CHEVRON_LEFT"
                            align="MIDDLE_RIGHT"
                            invoke="showPreviousWeek"/>
                <linkButton caption="msg://today"
                            invoke="setToday"
                            align="MIDDLE_RIGHT"/>
                <linkButton icon="font-icon:CHEVRON_RIGHT"
                            align="MIDDLE_RIGHT"
                            invoke="showNextWeek"/>
            </hbox>
        </buttonsPanel>
        <split id="split"
               orientation="horizontal"
               pos="30"
               width="100%">
            <vbox height="100%"
                  margin="false,true,false,false"
                  expand="usersTable"
                  spacing="true">
                <hbox height="28px">
                    <label value="msg://participantsTitle" align="MIDDLE_LEFT" stylename="h2"/>
                </hbox>
                <table id="usersTable"
                       width="100%">
                    <columns>
                        <column id="lastName"/>
                        <column id="firstName"/>
                    </columns>
                    <rows datasource="usersDs"/>
                </table>
            </vbox>
            <vbox height="100%"
                  margin="false,false,false,true"
                  expand="weeklyReportsTable"
                  spacing="true">
                <hbox spacing="true" height="28px" width="100%">
                    <optionsGroup id="statusOption" orientation="horizontal" multiselect="true"/>
                    <optionsGroup id="typeOption" orientation="horizontal" align="MIDDLE_RIGHT"/>
                </hbox>
                <table id="weeklyReportsTable"
                       reorderingAllowed="false"
                       width="100%">
                    <columns>
                        <column id="project"/>
                        <column id="task"/>
                    </columns>
                    <rows datasource="weeklyEntriesDs"/>
                </table>
            </vbox>
        </split>
    </layout>
</window>
