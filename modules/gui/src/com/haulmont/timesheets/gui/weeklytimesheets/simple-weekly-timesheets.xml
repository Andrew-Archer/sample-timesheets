<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/5.5/window.xsd"
        caption="msg://browseCaption"
        class="com.haulmont.timesheets.gui.weeklytimesheets.SimpleWeeklyTimesheets"
        messagesPack="com.haulmont.timesheets.gui.weeklytimesheets">
    <dsContext>
        <collectionDatasource id="weeklyEntriesDs"
                              class="com.haulmont.timesheets.entity.WeeklyReportEntry"
                              refreshMode="NEVER"
                              allowCommit="false"/>
        <collectionDatasource id="projectsDs"
                              class="com.haulmont.timesheets.entity.Project"
                              view="project-full">
            <query>
                <![CDATA[select e from ts$Project e join e.tasks t join t.participants p where p.user.id = :session$userId and t.status = 'active' order by e.name]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <layout>
        <table id="weeklyTsTable"
               editable="true"
               aggregatable="true"
               height="100%"
               width="100%">
            <actions>
                <action id="add"
                        icon="icons/plus-btn.png"
                        invoke="addReport"/>
                <action id="remove"/>
                <action id="submitAll"
                        caption="msg://submitAll"
                        invoke="submitAll"/>
            </actions>
            <columns>
                <column id="project"/>
                <column id="task"/>
                <column id="monday"
                        width="80px"/>
                <column id="tuesday"
                        width="80px"/>
                <column id="wednesday"
                        width="80px"/>
                <column id="thursday"
                        width="80px"/>
                <column id="friday"
                        width="80px"/>
                <column id="saturday"
                        width="80px"/>
                <column id="sunday"
                        width="80px"/>
            </columns>
            <rows datasource="weeklyEntriesDs"/>
            <buttonsPanel width="100%">
                <hbox spacing="true"
                      align="MIDDLE_LEFT">
                    <button action="weeklyTsTable.add"/>
                    <button action="weeklyTsTable.remove"/>
                </hbox>
                <label id="weekCaption" stylename="h2" align="MIDDLE_CENTER"/>
                <hbox id="weekNavigationBox"
                      spacing="true"
                      align="BOTTOM_RIGHT">
                    <button action="weeklyTsTable.submitAll"/>
                    <dateField id="dateField"
                               resolution="DAY"
                               stylename="simple"
                               align="MIDDLE_RIGHT"/>
                    <linkButton icon="font-icon:CHEVRON_LEFT"
                                align="MIDDLE_RIGHT"
                                invoke="movePreviousWeek"/>
                    <linkButton caption="msg://today"
                                invoke="setCurrentWeek"
                                align="MIDDLE_RIGHT"/>
                    <linkButton icon="font-icon:CHEVRON_RIGHT"
                                align="MIDDLE_RIGHT"
                                invoke="moveNextWeek"/>
                </hbox>
            </buttonsPanel>
        </table>
    </layout>
</window>
