<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/5.5/window.xsd"
        caption="msg://browseCaption"
        class="com.haulmont.timesheets.gui.weeklytimesheets.SimpleWeeklyTimesheets"
        focusComponent="weeklyTsTable"
        messagesPack="com.haulmont.timesheets.gui.weeklytimesheets">
    <dsContext>
        <collectionDatasource id="weeklyEntriesDs"
                              class="com.haulmont.timesheets.entity.WeeklyReportEntry"
                              refreshMode="NEVER"
                              allowCommit="false"/>
        <collectionDatasource id="projectsDs"
                              class="com.haulmont.timesheets.entity.Project"
                              view="project-full">
            <query>
                <![CDATA[
                select pr
                from ts$Project pr,
                    in(pr.participants) p
                where
                    p.user.id = :session$userId and
                    pr.status = 'open' order by pr.name
                    ]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <layout expand="weeklyTsTable" spacing="true">
        <iframe id="commandLine"
                screen="command-line-frame"/>
        <table id="weeklyTsTable"
               editable="true"
               reorderingAllowed="false"
               multiselect="true"
               aggregatable="true"
               width="100%">
            <actions>
                <action id="add"
                        icon="icons/plus-btn.png"
                        invoke="addReport"/>
                <action id="remove"/>
                <action id="submitAll" shortcut="CTRL-ENTER"
                        caption="msg://submitAll"
                        invoke="submitAll"/>
            </actions>
            <columns>
                <column id="project"/>
                <column id="task"/>
            </columns>
            <rows datasource="weeklyEntriesDs"/>
            <buttonsPanel width="100%">
                <hbox spacing="true"
                      align="MIDDLE_LEFT">
                    <button action="weeklyTsTable.add"/>
                    <button action="weeklyTsTable.remove"/>
                </hbox>
                <label id="weekCaption" stylename="h2" align="MIDDLE_CENTER"/>
                <hbox id="weekNavigationBox"
                      spacing="true"
                      align="BOTTOM_RIGHT">
                    <button action="weeklyTsTable.submitAll"/>
                    <dateField id="dateField"
                               resolution="DAY"
                               stylename="simple"
                               align="MIDDLE_RIGHT"/>
                    <linkButton icon="font-icon:CHEVRON_LEFT"
                                align="MIDDLE_RIGHT"
                                invoke="showPreviousWeek"/>
                    <linkButton caption="msg://today"
                                invoke="setToday"
                                align="MIDDLE_RIGHT"/>
                    <linkButton icon="font-icon:CHEVRON_RIGHT"
                                align="MIDDLE_RIGHT"
                                invoke="showNextWeek"/>
                </hbox>
            </buttonsPanel>
        </table>
    </layout>
</window>
